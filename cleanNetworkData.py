import pandas as pd

data_types = {
    'ts': float,
    'uid': str,
    'id.orig_h': str,
    'id.orig_p': int,
    'id.resp_h': str,
    'id.resp_p': int,
    'proto': str,
    'service': str,
    'duration': float,
    'orig_bytes': int,
    'resp_bytes': int,
    'conn_state': str,
    'local_orig': int,
    'local_resp': int,
    'missed_bytes': int,
    'history': str,
    'orig_pkts': int,
    'orig_ip_bytes': int,
    'resp_pkts': int,
    'resp_ip_bytes': int,
    'tunnel_parents': str,
    'label': str,
    'detailed-label': str,
}

def readAndCleanData(path):
    network_data = pd.read_csv(path, sep='|', dtype=data_types, keep_default_na=True, na_values='-')
    network_data = network_data.drop(columns=['uid', 'local_orig', 'local_resp', 'tunnel_parents', 'detailed-label']).dropna()

    print(f'{path}: {len(network_data.index)} read')

    return network_data

nd_1 = readAndCleanData('data/CTU-IoT-Malware-Capture-1-1conn.log.labeled.csv')
nd_2 = readAndCleanData('data/CTU-IoT-Malware-Capture-3-1conn.log.labeled.csv')
nd_3 = readAndCleanData('data/CTU-IoT-Malware-Capture-9-1conn.log.labeled.csv')
nd_4 = readAndCleanData('data/CTU-IoT-Malware-Capture-20-1conn.log.labeled.csv')
nd_5 = readAndCleanData('data/CTU-IoT-Malware-Capture-21-1conn.log.labeled.csv')
nd_6 = readAndCleanData('data/CTU-IoT-Malware-Capture-34-1conn.log.labeled.csv')
nd_7 = readAndCleanData('data/CTU-IoT-Malware-Capture-35-1conn.log.labeled.csv')
nd_8 = readAndCleanData('data/CTU-IoT-Malware-Capture-42-1conn.log.labeled.csv')
nd_9 = readAndCleanData('data/CTU-IoT-Malware-Capture-44-1conn.log.labeled.csv')
nd_10 = readAndCleanData('data/CTU-IoT-Malware-Capture-48-1conn.log.labeled.csv')
nd_11 = readAndCleanData('data/CTU-IoT-Malware-Capture-60-1conn.log.labeled.csv')

frames = [nd_1, nd_2, nd_3, nd_4, nd_5, nd_6, nd_7, nd_8, nd_9, nd_10, nd_11]
master = pd.concat(frames)

master.to_csv('data/master.csv')